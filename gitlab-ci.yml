Monitor-B07:
  stage: monitor
  image: python:3.9
  variables:
    PREENV: "dev"  # Change to your target environment
  before_script:
    - pip install kubernetes requests tabulate reportlab
  script:
    - |
      if [ $PREENV = dev ]
      then
        
        # Setup kubectl (download once)
        curl -LO https://storage.googleapis.com/kubernetes-release/release/stable.txt
        curl -LO https://storage.googleapis.com/kubernetes-release/release/$(cat stable.txt)/bin/linux/amd64/kubectl
        chmod +x kubectl
        mv kubectl /usr/local/bin/
        
        USERNAME=$B07USERNAME
        PASSWORD=$B07PASSWORD
        
        # Setup kubeconfig using your existing config file pattern
        sed -i "s@USERNAME@$USERNAME@" b07config-west
        sed -i "s@PASSWORD@$PASSWORD@" b07config-west
        
        echo '========================listing B07 Monitor======================='
        
        # Run the health check with your config file
        python k8s_health_check.py your-namespace-here --output-format both --output-dir reports
        
      else
        echo $USERNAME
      fi
  tags:
    - test-2
  artifacts:
    reports:
      junit: reports/junit.xml
    paths:
      - reports/
    expire_in: 1 week
    when: always
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
    - if: '$CI_COMMIT_BRANCH == "main"'
    - when: manual
